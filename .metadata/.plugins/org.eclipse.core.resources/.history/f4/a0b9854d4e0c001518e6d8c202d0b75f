package com.epam.newyeargift.dao;

import org.xml.sax.SAXException;

import com.epam.newyeargift.entity.Candy;
import com.epam.newyeargift.entity.GiftBox;

public class DomParser implements DataAccessDao {

	@Override
	public GiftBox getGiftFromSource(Object... args) throws DaoException {
		try {
            String filePath = (String) args[0];
            Library library = new Library();
            ArrayList<Book> books = (ArrayList<Book>) library.getBook();

            DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();
            factory.setValidating(false);
            DocumentBuilder builder = factory.newDocumentBuilder();
            Document document = builder.parse(new File(filePath));
            Element rootElement = document.getDocumentElement();

            NodeList bookList = rootElement.getElementsByTagName("book");

            for (int i = 0; i < bookList.getLength(); i++) {
                Candy candy = new Candy();
                
                NodeList list = ((Element) bookList.item(i)).getElementsByTagName("*");
                NamedNodeMap attributes = bookList.item(i).getAttributes();
                candy.setID(attributes.item(0).getTextContent());
                candy.setBookName(attributes.item(1).getTextContent());

                candy.setWriter(list.item(0).getTextContent());
                candy.setPaperback(list.item(1).getTextContent());
                candy.setYear(Integer.parseInt(list.item(2).getTextContent()));
                candy.setPage(Integer.parseInt(list.item(3).getTextContent()));
                
                books.add(candy);
            }
            return library;
        } catch (SAXException | IOException | ParserConfigurationException ex) {
            throw new DaoException(ex.getMessage(), ex);
        }
	}

}
