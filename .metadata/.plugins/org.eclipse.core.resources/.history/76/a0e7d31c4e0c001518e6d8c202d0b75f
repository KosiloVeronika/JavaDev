package com.epam.newyeargift.dao;

import org.xml.sax.SAXException;

import com.epam.newyeargift.entity.GiftBox;

public class DomParser implements DataAccessDao {

	@Override
	public GiftBox getGiftFromSource(Object... args) throws DaoException {
		try {
            String filePath = (String) args[0];
            Library library = new Library();
            ArrayList<Book> books = (ArrayList<Book>) library.getBook();

            DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();
            factory.setValidating(false);
            DocumentBuilder builder = factory.newDocumentBuilder();
            Document document = builder.parse(new File(filePath));
            Element rootElement = document.getDocumentElement();

            NodeList bookList = rootElement.getElementsByTagName("book");

            for (int i = 0; i < bookList.getLength(); i++) {
                Book book = new Book();
                
                NodeList list = ((Element) bookList.item(i)).getElementsByTagName("*");
                NamedNodeMap attributes = bookList.item(i).getAttributes();
                book.setID(attributes.item(0).getTextContent());
                book.setBookName(attributes.item(1).getTextContent());

                book.setWriter(list.item(0).getTextContent());
                book.setPaperback(list.item(1).getTextContent());
                book.setYear(Integer.parseInt(list.item(2).getTextContent()));
                book.setPage(Integer.parseInt(list.item(3).getTextContent()));
                
                books.add(book);
            }
            return library;
        } catch (SAXException | IOException | ParserConfigurationException ex) {
            throw new DaoException(ex.getMessage(), ex);
        }
	}

}
